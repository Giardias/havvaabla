<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | GLOBALEX</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div id="loadingText">Oturum kontrol ediliyor...</div>
    </div>

    <div id="adminPanel" class="admin-panel">
        <div class="admin-header">
            <div class="header-left">
                <div class="header-logo">‚óà</div>
                <div class="header-title">GLOBALEX ADMIN</div>
                <div class="header-badge">BETA</div>
            </div>
            <div class="header-right">
                <div class="user-info">
                    <div class="user-avatar" id="userAvatar">A</div>
                    <div class="user-details">
                        <div class="user-name" id="userEmail">admin@globalex.digital</div>
                        <div class="user-role">Administrator</div>
                    </div>
                </div>
                <button class="logout-btn" id="logoutBtn">
                    <span>üö™</span> √áƒ±kƒ±≈ü
                </button>
            </div>
        </div>

        <div class="admin-container">
            <div class="admin-card">
                <h2 class="card-title">
                    <span>üìã</span> ≈ûablonlar
                </h2>
                <div class="templates">
                    <div class="template" onclick="fillTemplate('tech')">
                        <span class="template-tag">üîß TECH</span>
                        <h4>Edge Computing</h4>
                    </div>
                    <div class="template" onclick="fillTemplate('ai')">
                        <span class="template-tag">ü§ñ AI</span>
                        <h4>Multilinguale KI</h4>
                    </div>
                    <div class="template" onclick="fillTemplate('security')">
                        <span class="template-tag">üîí SEC</span>
                        <h4>Zero-Trust</h4>
                    </div>
                </div>
            </div>

            <div class="admin-card">
                <h2 class="card-title">
                    <span>üìù</span> Yeni Blog Yazƒ±sƒ±
                </h2>

                <form id="blogForm">
                    <div class="form-section">
                        <h3>Temel Bilgiler</h3>
                        
                        <div class="form-group">
                            <label>Ba≈ülƒ±k *</label>
                            <input type="text" id="title" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Kategori *</label>
                                <select id="category" required>
                                    <option value="Technologie">Technologie</option>
                                    <option value="Strategie">Strategie</option>
                                    <option value="Case Studies">Case Studies</option>
                                    <option value="Sicherheit & Compliance">Sicherheit</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Okuma S√ºresi</label>
                                <input type="number" id="readTime" value="5">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Slug (URL)</label>
                            <input type="text" id="slug">
                            <div class="slug-preview" id="slugPreview">globalex.digital/blog/...</div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>ƒ∞√ßerik</h3>
                        
                        <div class="form-group">
                            <label>ƒ∞√ßerik (HTML) *</label>
                            <textarea id="content" required></textarea>
                        </div>

                        <div class="form-group">
                            <label>√ñzet</label>
                            <textarea id="excerpt" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>G√∂rsel</h3>
                        
                        <div class="image-upload" onclick="document.getElementById('imageFile').click()">
                            <div class="image-upload-icon">üì∏</div>
                            <div class="image-upload-title">G√∂rsel Y√ºkle</div>
                            <div class="image-upload-hint">PNG, JPG, GIF (max 5MB)</div>
                        </div>
                        <input type="file" id="imageFile" accept="image/*" style="display: none;">
                        
                        <div class="image-preview" id="imagePreview"></div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Placeholder Text</label>
                                <input type="text" id="imageText" value="üìù Blog">
                            </div>
                            <div class="form-group">
                                <label>Gradient</label>
                                <input type="text" id="gradient" value="linear-gradient(135deg, #667eea 0%, #764ba2 100%)">
                                <div class="gradient-preview" id="gradientPreview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Yazar Bilgileri</h3>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label>Yazar Adƒ± *</label>
                                <input type="text" id="author" required>
                            </div>
                            <div class="form-group">
                                <label>Yazar √únvanƒ±</label>
                                <input type="text" id="authorTitle" value="Autor">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Yazar Avatar</label>
                            <input type="text" id="authorAvatar" placeholder="A">
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>Diƒüer Ayarlar</h3>
                        
                        <div class="checkbox-group">
                            <input type="checkbox" id="featured">
                            <label for="featured">√ñne √áƒ±kan Blog</label>
                        </div>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn-preview" id="previewBtn">
                            <span>üëÅÔ∏è</span> √ñnizle
                        </button>
                        <button type="submit" class="btn-submit" id="submitBtn">
                            <span>üì§</span> Bloƒüu Yayƒ±nla ‚Üí
                        </button>
                    </div>

                    <div class="info-box">
                        <strong>‚ÑπÔ∏è Bilgi:</strong>
                        - Zorunlu alanlar: Ba≈ülƒ±k, ƒ∞√ßerik, Yazar, Kategori<br>
                        - Slug bo≈ü bƒ±rakƒ±lƒ±rsa ba≈ülƒ±ktan otomatik olu≈üur<br>
                        - G√∂rsel y√ºklenmezse gradient kullanƒ±lƒ±r
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="importmap">
        {
            "imports": {
                "@firebase/app": "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js",
                "@firebase/auth": "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js",
                "@firebase/firestore": "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js",
                "@firebase/storage": "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js"
            }
        }
    </script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDhr_iR7w1qOs-SwDZ0FhGhF7RIAfiN1kI",
            authDomain: "havvaabla.firebaseapp.com",
            projectId: "havvaabla",
            storageBucket: "havvaabla.firebasestorage.app",
            messagingSenderId: "783441783764",
            appId: "1:783441783764:web:faec837359e01baaef8441"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);

        const loading = document.getElementById('loading');
        const adminPanel = document.getElementById('adminPanel');

        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('userEmail').textContent = user.email;
                document.getElementById('userAvatar').textContent = user.email.charAt(0).toUpperCase();
                loading.style.display = 'none';
                adminPanel.style.display = 'block';
            } else {
                window.location.href = 'admin-login.html';
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', async () => {
            await signOut(auth);
        });

        document.getElementById('blogForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = 'üì§ Y√ºkleniyor...';

            try {
                const title = document.getElementById('title').value;
                let slug = document.getElementById('slug').value;
                
                if (!slug) {
                    slug = title.toLowerCase()
                        .replace(/[^a-z0-9]/g, '-')
                        .replace(/-+/g, '-')
                        .replace(/^-|-$/g, '');
                }

                let imageUrl = null;
                const imageFile = document.getElementById('imageFile').files[0];
                
                if (imageFile) {
                    const fileName = `${slug}-${Date.now()}.${imageFile.name.split('.').pop()}`;
                    const storageRef = ref(storage, `blog-images/${fileName}`);
                    const snapshot = await uploadBytes(storageRef, imageFile);
                    imageUrl = await getDownloadURL(snapshot.ref);
                }

                const blogData = {
                    title: title,
                    slug: slug,
                    content: document.getElementById('content').value,
                    excerpt: document.getElementById('excerpt').value || document.getElementById('content').value.replace(/<[^>]*>/g, '').substring(0, 150) + '...',
                    category: document.getElementById('category').value,
                    author: document.getElementById('author').value,
                    authorTitle: document.getElementById('authorTitle').value,
                    authorAvatar: document.getElementById('authorAvatar').value || document.getElementById('author').value.charAt(0).toUpperCase(),
                    readTime: parseInt(document.getElementById('readTime').value) || 5,
                    featured: document.getElementById('featured').checked,
                    imageUrl: imageUrl,
                    imagePlaceholder: document.getElementById('imageText').value,
                    imageGradient: document.getElementById('gradient').value,
                    date: new Date().toISOString().split('T')[0],
                    timestamp: serverTimestamp(),
                    views: 0
                };

                await addDoc(collection(db, "blog_posts"), blogData);
                
                alert('‚úÖ Blog yayƒ±nlandƒ±!');
                
                if (confirm('Blog sayfasƒ±nƒ± a√ßmak ister misiniz?')) {
                    window.open('blog.html', '_blank');
                }
                
                document.getElementById('blogForm').reset();
                document.getElementById('imagePreview').innerHTML = '';

            } catch (error) {
                alert('‚ùå Hata: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span>üì§</span> Bloƒüu Yayƒ±nla ‚Üí';
            }
        });

        document.getElementById('previewBtn').addEventListener('click', () => {
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            
            if (!title || !content) {
                alert('Ba≈ülƒ±k ve i√ßerik gerekli!');
                return;
            }

            const win = window.open('', '_blank');
            win.document.write(`
                <html>
                <head><title>√ñnizleme</title></head>
                <body>
                    <h1>${title}</h1>
                    ${content}
                </body>
                </html>
            `);
        });

        document.getElementById('imageFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    document.getElementById('imagePreview').innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('title').addEventListener('blur', () => {
            const slugInput = document.getElementById('slug');
            if (!slugInput.value) {
                const newSlug = document.getElementById('title').value
                    .toLowerCase()
                    .replace(/[^a-z0-9]/g, '-')
                    .replace(/-+/g, '-')
                    .replace(/^-|-$/g, '');
                slugInput.value = newSlug;
                document.getElementById('slugPreview').textContent = `globalex.digital/blog/${newSlug}`;
            }
        });

        window.fillTemplate = (type) => {
            if (type === 'tech') {
                document.getElementById('title').value = 'Edge Computing';
                document.getElementById('category').value = 'Technologie';
                document.getElementById('author').value = 'Michael Schneider';
                document.getElementById('content').value = '<h2>Edge Computing</h2><p>Edge Computing i√ßeriƒüi...</p>';
            } else if (type === 'ai') {
                document.getElementById('title').value = 'Multilinguale KI';
                document.getElementById('category').value = 'Technologie';
                document.getElementById('author').value = 'Dr. Robert Schmidt';
                document.getElementById('featured').checked = true;
                document.getElementById('content').value = '<h2>Multilinguale KI</h2><p>ƒ∞√ßerik...</p>';
            } else if (type === 'security') {
                document.getElementById('title').value = 'Zero-Trust';
                document.getElementById('category').value = 'Sicherheit & Compliance';
                document.getElementById('author').value = 'Sarah Bauer';
                document.getElementById('content').value = '<h2>Zero Trust</h2><p>ƒ∞√ßerik...</p>';
            }
        };
    </script>
</body>
</html>